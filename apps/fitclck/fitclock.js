!function(){var e=require("Storage");var t="fitclock.log",n=0,r=0,l=null,o=0,a=0,i=new Date,s=Graphics.createArrayBuffer(240,240,1,{msb:!0});var c,p="     ",u="BPM: ";const d={" ":e=>[],0:e=>[[e,0,1,0],[1,0,1,1],[1,1,1,2],[e,2,1,2],[e,1,e,2],[e,0,e,1]],1:e=>[[1-e,0,1,0],[1,0,1,1],[1-e,1,1,1],[1-e,1,1-e,2],[1-e,2,1,2]],2:e=>[[0,0,1,0],[1,0,1,1],[0,1,1,1],[0,1+e,0,2],[1,2-e,1,2],[0,2,1,2]],3:e=>[[0,0,1-e,0],[0,0,0,e],[1,0,1,1],[0,1,1,1],[1,1,1,2],[e,2,1,2]],4:e=>[[0,0,0,1],[1,0,1-e,0],[1,0,1,1-e],[0,1,1,1],[1,1,1,2],[1-e,2,1,2]],5:(e,t)=>t?[[0,0,0,1],[0,0,1,0],[e,1,1,1],[1,1,1,2],[0,2,1,2],[0,2,0,2],[1,1-e,1,1],[0,1,0,1+e]]:[[0,0,0,1],[0,0,1,0],[0,1,1,1],[1,1,1,2],[0,2,1,2],[0,2-e,0,2]],6:e=>[[0,0,0,1-e],[0,0,1,0],[e,1,1,1],[1,1-e,1,1],[1,1,1,2],[e,2,1,2],[0,1-e,0,2-2*e]],7:e=>[[0,0,0,e],[0,0,1,0],[1,0,1,1],[1-e,1,1,1],[1,1,1,2],[1-e,2,1,2],[1-e,1,1-e,2]],8:e=>[[0,0,0,1],[0,0,1,0],[1,0,1,1],[0,1,1,1],[1,1,1,2],[0,2,1,2],[0,1,0,2-e]],9:e=>[[0,0,0,1],[0,0,1,0],[1,0,1,1],[0,1,1-e,1],[0,1,0,1+e],[1,1,1,2],[0,2,1,2]],":":e=>[[.4,.4,.6,.4],[.6,.4,.6,.6],[.6,.6,.4,.6],[.4,.4,.4,.6],[.4,1.4,.6,1.4],[.6,1.4,.6,1.6],[.6,1.6,.4,1.6],[.4,1.4,.4,1.6]]};function B(e,t,o){s.clear();var i=1;var c=2;const p=34;for(var B=0;B<e.length;B++){var f=e[B],F=t[B];":"==F&&(i-=4);var A,w=o;void 0!==f&&(F-1==f||0==F&&5==f||0==F&&9==f)?A=f:(A=F,w=0),d[A](w,5==f&&0==F).forEach(e=>{e[0]!=e[2]?s.fillRect(i+e[0]*p,c+e[1]*p-2,i+e[2]*p,c+e[3]*p+2):e[1]!=e[3]&&s.fillRect(i+e[0]*p-2,c+e[1]*p,i+e[2]*p+2,c+e[3]*p)}),":"==F&&(i-=4),i+=43}c+=68;var S=new Date;s.setFont("6x8"),s.setFontAlign(-1,-1),s.drawString(("0"+S.getSeconds()).substr(-2),i,c-8),s.setFontAlign(0,-1);var L=S.toString().substr(0,15);s.drawString(L,s.getWidth()/2,c+8),1==n&&(s.setFont("6x8"),s.setFontVector(12),s.setFontAlign(0,-1),s.drawString(u,s.getWidth()/2,c+24)),1==r&&(s.setFont("6x8"),s.setFontVector(12),s.setFontAlign(0,-1),s.drawString("GPS ON",s.getWidth()/2,c+40),null!=l&&l.satellites>0&&(s.setFont("6x8"),s.setFontAlign(0,-1),s.drawString(l.satellites+" satellites",s.getWidth()/2,c+64))),a>0&&(s.setFont("6x8"),s.setFontAlign(0,-1),s.drawString("Steps "+a,s.getWidth()/2,c+80)),Bangle.AppLog.error&&(s.setFont("6x8"),s.setFontVector(12),s.setFontAlign(0,-1),s.drawString("ERROR",s.getWidth()/2,c+96)),Bangle.AppLog.diskFull&&(s.setFont("6x8"),s.setFontVector(12),s.setFontAlign(0,-1),s.drawString("DISK FULL",s.getWidth()/2,c+112)),g.setColor(1,1,1),g.drawImage({width:s.getWidth(),height:s.getHeight(),buffer:s.buffer},0,50)}function f(){if(Bangle.isLCDOn()&&!c){var e=new Date,t=(" "+e.getHours()).substr(-2)+":"+("0"+e.getMinutes()).substr(-2),n=p;if(t!=n){var r=0;c=setInterval((function(){(r+=.1)>=1&&(r=1,clearInterval(c),c=0),B(n,t,r)}),20),p=t}else B(t,n,0)}}function F(e){null==Bangle.AppLog.currentFile&&(console.log("Trying to create new file:"+t),Bangle.AppLog.init(t));try{Bangle.AppLog.write(e+"\n")}catch(e){console.log(e)}}function A(){n=0===n?1:0,Bangle.setHRMPower(n)}function w(){r=0===r?1:0,Bangle.setGPSPower(r)}Bangle.on("lcdPower",(function(e){e&&(f(),Bangle.drawWidgets())})),Bangle.on("step",(function(e){var t=new Date;i.getDate()==t.getDate()?a++:a=1,i=t;var n=Bangle.getAccel();F(`A,"${(new Date).toUTCString()}",${n.x},${n.y},${n.z},${n.diff},${n.mag}`)})),Bangle.on("GPS",(function(e){(l=e).satellites>0&&o<180?(o=0,setTime(l.time.getTime()/1e3),F(`G,"${(new Date).toUTCString()}",${l.satellites},${l.lat},${l.lon},${l.alt},${l.speed},${l.course},${l.time.ms}`)):++o>=180&&(o=0,r=0,Bangle.setGPSPower(r))})),Bangle.on("HRM",(function(e){u="BPM: "+e.bpm,F(`H,"${(new Date).toUTCString()}",${e.bpm},${e.confidence}`)})),E.on("kill",()=>{let e={lastUpdate:i.toISOString(),stepsToday:a,logError:Bangle.AppLog.error,logFull:Bangle.AppLog.diskFull};require("Storage").write("fitclock-settings.json",e)}),Bangle.AppLog={currentFile:null,lock:!1,shardCount:0,currentFileName:"",error:!1,diskFull:!1,init:t=>{Bangle.AppLog.currentFileName=t;try{null!=t&&""!=t?Bangle.AppLog.currentFile=e.open(t,"a"):console.error("Log file name not provided")}catch(e){console.log("Failed to create file",e)}},write:e=>{if(1!=Bangle.AppLog.lock&&1!=Bangle.AppLog.error)try{require("Storage").getFree()>(e+="\n").length?Bangle.AppLog.currentFile.write(e):Bangle.AppLog.diskFull=!0}catch(e){console.log(e),Bangle.AppLog.currentFile=null,Bangle.AppLog.error=!0}},clearLog:()=>{Bangle.AppLog.lock=!0,Bangle.AppLog.currentFile=null,require("Storage").open(Bangle.AppLog.currentFileName,"w").erase(),Bangle.AppLog.lock=!1,Bangle.AppLog.error=!1,load()},beginSync:()=>{for(var e=require("Storage").open(Bangle.AppLog.currentFileName,"r"),t="";null!=t&&-1==t.indexOf("Ã¿")&&null!=(t=e.readLine());)print(t);print("\x3c!-- finished sync --\x3e")}},Bangle.AppLog.error=!1,Bangle.Helper={size:e=>{var t=require("Storage").open(e,"r");print(t.getLength()),t=null},delete:e=>{var t=require("Storage").open(e,"w");t.erase(),t=null}},g.clear(),function(){let e=require("Storage").readJSON("fitclock-settings.json");e&&(e.lastUpdate&&(i=new Date(e.lastUpdate)),a=0|e.stepsToday)}(),setInterval(f,1e3),f(),r=1,Bangle.setGPSPower(r),n=1,Bangle.setHRMPower(n),setWatch(A,BTN1,{repeat:!0}),setWatch(w,BTN3,{repeat:!0}),Bangle.loadWidgets(),Bangle.drawWidgets()}();